<h1>Meeting List</h1>

<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
  <button class="toggle-btn" onclick="toggleSidebar()">☰</button>
  <span class="sidebar-title">Dashboard</span>
</div>
    <hr>
    </div>
    <ul>
        <li><a href="/admin/dashboard">Admin Dashboard</a></li>
        <li><a href="/admin/dashboard/tutor">Tutor Dashboard</a></li>
        <li><a href="/admin/dashboard/student">Student Dashboard</a></li>
        <li><a href="/userpage/admin">User Management</a></li>
        <li><a href="/blog">Blog Management</a></li>
        <li><a href="/document">Document Management</a></li>
        <li><a href="/api/meeting">Meeting</a></li>
        <li><a href="/class">Class</a></li>
        <li><a href="/schedule/schedule-view">Schedule</a></li>
        <li><a href="/attendance/all">View Attendance</a></li>
    </ul>
</div>
</div>

<script>
    function toggleSidebar() {
        const sidebar = document.querySelector('.sidebar');
        sidebar.classList.toggle('hidden');
    }
</script>

<div class="container">
<a href="/api/meeting/create" class="btn">Create A Meeting</a>
<table class="table table-bordered table-primary" border="1" cellspacing="0" cellpadding="10">
  <thead>
    <tr>
      <th>Title</th>
      <th>Form 
        <br>(Online - Offline)</th>
      <th>Location</th>
      <th>Status</th>
      <th>Begin Time</th>
      <th>End Time</th>
      <th>Tutor</th>
      <th>Student</th>
      <th>Note</th>
      <th>Date</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {{#each meetings}}
      <tr>
        <td>{{title}}</td>
        <td>{{form}}</td>
        <td>{{location}}</td>
        <td>{{status}}</td>
        <td>{{formatDate startTime}}</td>
        <td>{{formatDate endTime}}</td>
        <td>
          {{#each tutor}}
            <div>{{this.name}}</div>
          {{/each}}
        </td>
        <td>
          {{#each student}}
            <div>{{this.name}}</div>
          {{/each}}
        </td>
        <td>{{note}}</td>
        <td>{{formatDate createDate}}</td>
        <td>
          <a class="btn button-3" href="meeting/delete/{{ _id }}"
                        onclick="return confirm('Are you sure to delete this meeting ?');">Delete</a></td>
      </tr>
    {{/each}}
  </tbody>
</table>
</div>

<style>
  th{
    text-align: center;
  }
</style>

<script>
document.getElementById('createMeetingForm').addEventListener('submit', async function (e) {
  e.preventDefault(); // Ngăn submit mặc định

  const form = e.target;
  const formData = new FormData(form);

  // Lấy dữ liệu từ FormData thành object JS
  const data = {
    title: formData.get('title'),
    form: formData.get('form'),
    location: formData.get('location'),
    note: formData.get('note'),
    startTime: formData.get('startTime'),
    endTime: formData.get('endTime'),
    students: formData.getAll('students[]'),
    tutors: formData.getAll('tutors[]')
  };

  try {
    const response = await fetch('/api/meeting/create', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    });

    const result = await response.json();

    if (response.ok) {
      alert(result.message + "\nLink họp: " + result.meetLink);
      form.reset(); // Reset form nếu muốn
    } else {
      alert("Tạo lịch họp thất bại: " + (result.error || "Có lỗi xảy ra"));
    }

  } catch (error) {
    alert("Lỗi kết nối đến máy chủ: " + error.message);
  }
});
</script>

