<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tạo Lịch Họp</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h2 class="mb-4">Tạo Lịch Họp</h2>
        <form id = "createMeetingForm" action="/api/meeting/create" method="POST">
            <div class="mb-3">
                <label>Tiêu đề</label>
                <input type="text" class="form-control" name="title" required>
            </div>
            <div class="mb-3">
                <label>Hình thức</label>
                <input type="text" class="form-control" name="form" required>
            </div>
            <div class="mb-3">
                <label>Địa điểm</label>
                <input type="text" class="form-control" name="location" required>
            </div>
            <div class="mb-3">
                <label>Sinh viên</label>
                <select class="form-control" name="students[]" required>
                    {{#each students}}
                        <option value="{{this._id}}">{{this.name}}</option>
                    {{/each}}
                </select>
                <select class="form-control" name="students[]" required>
                    {{#each students}}
                        <option value="{{this._id}}">{{this.name}}</option>
                    {{/each}}
                </select>
            </div>
            <div class="mb-3">
                <label>Giáo viên</label>
                <select class="form-control" name="tutors[]" required>
                    {{#each tutors}}
                        <option value="{{this._id}}">{{this.name}}</option>
                    {{/each}}
                </select>
            </div>
                        <div class="mb-3">
                <label>Thời gian bắt đầu</label>
                <input type="dateTime-local" name="startTime" required>
            </div>
            <div class="mb-3">
                <label>Thời gian kết thúc</label>
                <input type="dateTime-local" name="endTime" required>
            </div>
            <div class="mb-3">
                <label>Ghi chú</label>
                <textarea class="form-control" name="note"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Tạo Lịch Họp</button>
        </form>
    </div>
</body>
</html>


<script>
document.getElementById('createMeetingForm').addEventListener('submit', async function (e) {
  e.preventDefault(); // Ngăn submit mặc định

  const form = e.target;
  const formData = new FormData(form);

  // Lấy dữ liệu từ FormData thành object JS
  const data = {
    title: formData.get('title'),
    form: formData.get('form'),
    location: formData.get('location'),
    note: formData.get('note'),
    startTime: formData.get('startTime'),
    endTime: formData.get('endTime'),
    students: formData.getAll('students[]'),
    tutors: formData.getAll('tutors[]')
  };

  try {
    const response = await fetch('/api/meeting/create', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    });

    const result = await response.json();

    if (response.ok) {
      alert(result.message + "\nLink họp: " + result.meetLink);
      form.reset(); // Reset form nếu muốn
    } else {
      alert("Tạo lịch họp thất bại: " + (result.error || "Có lỗi xảy ra"));
    }

  } catch (error) {
    alert("Lỗi kết nối đến máy chủ: " + error.message);
  }
});
</script>

